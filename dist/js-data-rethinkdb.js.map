{"version":3,"file":null,"sources":["../src/index.js"],"sourcesContent":["import {utils} from 'js-data'\nimport {\n  Adapter,\n  reserved\n} from 'js-data-adapter'\nimport rethinkdbdash from 'rethinkdbdash'\nimport underscore from 'mout/string/underscore'\n\nconst __super__ = Adapter.prototype\n\nconst R_OPTS_DEFAULTS = {\n  db: 'test'\n}\nconst INSERT_OPTS_DEFAULTS = {}\nconst UPDATE_OPTS_DEFAULTS = {}\nconst DELETE_OPTS_DEFAULTS = {}\nconst RUN_OPTS_DEFAULTS = {}\n\nconst equal = function (r, row, field, value) {\n  return row(field).default(null).eq(value)\n}\n\nconst notEqual = function (r, row, field, value) {\n  return row(field).default(null).ne(value)\n}\n\n/**\n * Default predicate functions for the filtering operators.\n *\n * @name module:js-data-rethinkdb.OPERATORS\n * @property {function} = Equality operator.\n * @property {function} == Equality operator.\n * @property {function} != Inequality operator.\n * @property {function} > \"Greater than\" operator.\n * @property {function} >= \"Greater than or equal to\" operator.\n * @property {function} < \"Less than\" operator.\n * @property {function} <= \"Less than or equal to\" operator.\n * @property {function} isectEmpty Operator to test that the intersection\n * between two arrays is empty.\n * @property {function} isectNotEmpty Operator to test that the intersection\n * between two arrays is NOT empty.\n * @property {function} in Operator to test whether a value is found in the\n * provided array.\n * @property {function} notIn Operator to test whether a value is NOT found in\n * the provided array.\n * @property {function} contains Operator to test whether an array contains the\n * provided value.\n * @property {function} notContains Operator to test whether an array does NOT\n * contain the provided value.\n */\nexport const OPERATORS = {\n  '=': equal,\n  '==': equal,\n  '===': equal,\n  '!=': notEqual,\n  '!==': notEqual,\n  '>': function (r, row, field, value) {\n    return row(field).default(null).gt(value)\n  },\n  '>=': function (r, row, field, value) {\n    return row(field).default(null).ge(value)\n  },\n  '<': function (r, row, field, value) {\n    return row(field).default(null).lt(value)\n  },\n  '<=': function (r, row, field, value) {\n    return row(field).default(null).le(value)\n  },\n  'isectEmpty': function (r, row, field, value) {\n    return row(field).default([]).setIntersection(r.expr(value).default([])).count().eq(0)\n  },\n  'isectNotEmpty': function (r, row, field, value) {\n    return row(field).default([]).setIntersection(r.expr(value).default([])).count().ne(0)\n  },\n  'in': function (r, row, field, value) {\n    return r.expr(value).default(r.expr([])).contains(row(field).default(null))\n  },\n  'notIn': function (r, row, field, value) {\n    return r.expr(value).default(r.expr([])).contains(row(field).default(null)).not()\n  },\n  'contains': function (r, row, field, value) {\n    return row(field).default([]).contains(value)\n  },\n  'notContains': function (r, row, field, value) {\n    return row(field).default([]).contains(value).not()\n  }\n}\n\nObject.freeze(OPERATORS)\n\n/**\n * RethinkDBAdapter class.\n *\n * @example\n * // Use Container instead of DataStore on the server\n * import {Container} from 'js-data'\n * import {RethinkDBAdapter} from 'js-data-rethinkdb'\n *\n * // Create a store to hold your Mappers\n * const store = new Container()\n *\n * // Create an instance of RethinkDBAdapter with default settings\n * const adapter = new RethinkDBAdapter()\n *\n * // Mappers in \"store\" will use the RethinkDB adapter by default\n * store.registerAdapter('rethinkdb', adapter, { default: true })\n *\n * // Create a Mapper that maps to a \"user\" table\n * store.defineMapper('user')\n *\n * @class RethinkDBAdapter\n * @extends Adapter\n * @param {object} [opts] Configuration options.\n * @param {boolean} [opts.debug=false] See {@link Adapter#debug}.\n * @param {object} [opts.deleteOpts={}] See {@link RethinkDBAdapter#deleteOpts}.\n * @param {object} [opts.insertOpts={}] See {@link RethinkDBAdapter#insertOpts}.\n * @param {object} [opts.operators={@link module:js-data-rethinkdb.OPERATORS}] See {@link RethinkDBAdapter#operators}.\n * @param {object} [opts.r] See {@link RethinkDBAdapter#r}.\n * @param {boolean} [opts.raw=false] See {@link Adapter#raw}.\n * @param {object} [opts.rOpts={}] See {@link RethinkDBAdapter#rOpts}.\n * @param {object} [opts.runOpts={}] See {@link RethinkDBAdapter#runOpts}.\n * @param {object} [opts.updateOpts={}] See {@link RethinkDBAdapter#updateOpts}.\n */\nexport function RethinkDBAdapter (opts) {\n  utils.classCallCheck(this, RethinkDBAdapter)\n  opts || (opts = {})\n\n  // Setup non-enumerable properties\n  Object.defineProperties(this, {\n    /**\n     * The rethinkdbdash instance used by this adapter. Use this directly when\n     * you need to write custom queries.\n     *\n     * @example <caption>Use default instance.</caption>\n     * import {RethinkDBAdapter} from 'js-data-rethinkdb'\n     * const adapter = new RethinkDBAdapter()\n     * adapter.r.dbDrop('foo').then(...)\n     *\n     * @example <caption>Configure default instance.</caption>\n     * import {RethinkDBAdapter} from 'js-data-rethinkdb'\n     * const adapter = new RethinkDBAdapter({\n     *   rOpts: {\n     *     user: 'myUser',\n     *     password: 'myPassword'\n     *   }\n     * })\n     * adapter.r.dbDrop('foo').then(...)\n     *\n     * @example <caption>Provide a custom instance.</caption>\n     * import rethinkdbdash from 'rethinkdbdash'\n     * import {RethinkDBAdapter} from 'js-data-rethinkdb'\n     * const r = rethinkdbdash()\n     * const adapter = new RethinkDBAdapter({\n     *   r: r\n     * })\n     * adapter.r.dbDrop('foo').then(...)\n     *\n     * @name RethinkDBAdapter#r\n     * @type {object}\n     */\n    r: {\n      writable: true,\n      value: undefined\n    },\n    databases: {\n      value: {}\n    },\n    indices: {\n      value: {}\n    },\n    tables: {\n      value: {}\n    }\n  })\n\n  Adapter.call(this, opts)\n\n  /**\n   * Default options to pass to r#insert.\n   *\n   * @name RethinkDBAdapter#insertOpts\n   * @type {object}\n   * @default {}\n   */\n  this.insertOpts || (this.insertOpts = {})\n  utils.fillIn(this.insertOpts, INSERT_OPTS_DEFAULTS)\n\n  /**\n   * Default options to pass to r#update.\n   *\n   * @name RethinkDBAdapter#updateOpts\n   * @type {object}\n   * @default {}\n   */\n  this.updateOpts || (this.updateOpts = {})\n  utils.fillIn(this.updateOpts, UPDATE_OPTS_DEFAULTS)\n\n  /**\n   * Default options to pass to r#delete.\n   *\n   * @name RethinkDBAdapter#deleteOpts\n   * @type {object}\n   * @default {}\n   */\n  this.deleteOpts || (this.deleteOpts = {})\n  utils.fillIn(this.deleteOpts, DELETE_OPTS_DEFAULTS)\n\n  /**\n   * Default options to pass to r#run.\n   *\n   * @name RethinkDBAdapter#runOpts\n   * @type {object}\n   * @default {}\n   */\n  this.runOpts || (this.runOpts = {})\n  utils.fillIn(this.runOpts, RUN_OPTS_DEFAULTS)\n\n  /**\n   * Override the default predicate functions for the specified operators.\n   *\n   * @name RethinkDBAdapter#operators\n   * @type {object}\n   * @default {}\n   */\n  this.operators || (this.operators = {})\n  utils.fillIn(this.operators, OPERATORS)\n\n  /**\n   * Options to pass to a new `rethinkdbdash` instance, if one was not provided\n   * at {@link RethinkDBAdapter#r}. See the [rethinkdbdash README][readme] for\n   * instance options.\n   *\n   * [readme]: https://github.com/neumino/rethinkdbdash#importing-the-driver\n   *\n   * @example <caption>Connect to localhost:8080, and let the driver find other instances.</caption>\n   * import {RethinkDBAdapter} from 'js-data-rethinkdb'\n   * const adapter = new RethinkDBAdapter({\n   *   rOpts: {\n   *     discovery: true\n   *   }\n   * })\n   *\n   * @example <caption>Connect to and only to localhost:8080.</caption>\n   * import {RethinkDBAdapter} from 'js-data-rethinkdb'\n   * const adapter = new RethinkDBAdapter()\n   *\n   * @example <caption>Do not create a connection pool.</caption>\n   * import {RethinkDBAdapter} from 'js-data-rethinkdb'\n   * const adapter = new RethinkDBAdapter({\n   *   rOpts: {\n   *     pool: false\n   *   }\n   * })\n   *\n   * @example <caption>Connect to a cluster seeding from `192.168.0.100`, `192.168.0.101`, `192.168.0.102`.</caption>\n   * import {RethinkDBAdapter} from 'js-data-rethinkdb'\n   * const adapter = new RethinkDBAdapter({\n   *   rOpts: {\n   *     servers: [\n   *       { host: '192.168.0.100', port: 28015 },\n   *       { host: '192.168.0.101', port: 28015 },\n   *       { host: '192.168.0.102', port: 28015 }\n   *     ]\n   *   }\n   * })\n   *\n   * @name RethinkDBAdapter#rOpts\n   * @see https://github.com/neumino/rethinkdbdash#importing-the-driver\n   * @type {object}\n   */\n  this.rOpts || (this.rOpts = {})\n  utils.fillIn(this.rOpts, R_OPTS_DEFAULTS)\n\n  this.r || (this.r = rethinkdbdash(this.rOpts))\n}\n\nAdapter.extend({\n  constructor: RethinkDBAdapter,\n\n  _handleErrors (cursor) {\n    if (cursor && cursor.errors > 0) {\n      if (cursor.first_error) {\n        throw new Error(cursor.first_error)\n      }\n      throw new Error('Unknown RethinkDB Error')\n    }\n  },\n\n  _count (mapper, query, opts) {\n    opts || (opts = {})\n    query || (query = {})\n\n    return this.filterSequence(this.selectTable(mapper, opts), query)\n      .count()\n      .run(this.getOpt('runOpts', opts))\n      .then((count) => [count, {}])\n  },\n\n  _create (mapper, props, opts) {\n    props || (props = {})\n    opts || (opts = {})\n\n    const insertOpts = this.getOpt('insertOpts', opts)\n    insertOpts.returnChanges = true\n\n    return this.selectTable(mapper, opts)\n      .insert(props, insertOpts)\n      .run(this.getOpt('runOpts', opts))\n      .then((cursor) => {\n        this._handleErrors(cursor)\n        let record\n        if (cursor && cursor.changes && cursor.changes.length && cursor.changes[0].new_val) {\n          record = cursor.changes[0].new_val\n        }\n        return [record, cursor]\n      })\n  },\n\n  _createMany (mapper, props, opts) {\n    props || (props = {})\n    opts || (opts = {})\n\n    const insertOpts = this.getOpt('insertOpts', opts)\n    insertOpts.returnChanges = true\n\n    return this.selectTable(mapper, opts)\n      .insert(props, insertOpts)\n      .run(this.getOpt('runOpts', opts))\n      .then((cursor) => {\n        this._handleErrors(cursor)\n        let records = []\n        if (cursor && cursor.changes && cursor.changes.length && cursor.changes) {\n          records = cursor.changes.map((change) => change.new_val)\n        }\n        return [records, cursor]\n      })\n  },\n\n  _destroy (mapper, id, opts) {\n    opts || (opts = {})\n\n    return this.selectTable(mapper, opts)\n      .get(id)\n      .delete(this.getOpt('deleteOpts', opts))\n      .run(this.getOpt('runOpts', opts))\n      .then((cursor) => {\n        this._handleErrors(cursor)\n        return [undefined, cursor]\n      })\n  },\n\n  _destroyAll (mapper, query, opts) {\n    query || (query = {})\n    opts || (opts = {})\n\n    return this.filterSequence(this.selectTable(mapper, opts), query)\n      .delete(this.getOpt('deleteOpts', opts))\n      .run(this.getOpt('runOpts', opts))\n      .then((cursor) => {\n        this._handleErrors(cursor)\n        return [undefined, cursor]\n      })\n  },\n\n  _find (mapper, id, opts) {\n    opts || (opts = {})\n\n    return this._pluck(mapper, this.selectTable(mapper, opts).get(id), opts)\n      .run(this.getOpt('runOpts', opts))\n      .then((record) => [record, {}])\n  },\n\n  _findAll (mapper, query, opts) {\n    opts || (opts = {})\n    query || (query = {})\n\n    return this._pluck(mapper, this.filterSequence(this.selectTable(mapper, opts), query), opts)\n      .run(this.getOpt('runOpts', opts))\n      .then((records) => [records, {}])\n  },\n\n  _pluck (mapper, rql, opts) {\n    if (utils.isString(opts.fields)) {\n      opts.fields = [opts.fields]\n    }\n    if (utils.isArray(opts.fields)) {\n      return rql.pluck(...opts.fields)\n    }\n    return rql\n  },\n\n  _sum (mapper, field, query, opts) {\n    if (!utils.isString(field)) {\n      throw new Error('field must be a string!')\n    }\n    opts || (opts = {})\n    query || (query = {})\n\n    return this.filterSequence(this.selectTable(mapper, opts), query)\n      .sum(field)\n      .run(this.getOpt('runOpts', opts))\n      .then((sum) => [sum, {}])\n  },\n\n  _update (mapper, id, props, opts) {\n    props || (props = {})\n    opts || (opts = {})\n\n    const updateOpts = this.getOpt('updateOpts', opts)\n    updateOpts.returnChanges = \"always\"\n\n    return this.selectTable(mapper, opts)\n      .update(props, updateOpts)\n      .run(this.getOpt('runOpts', opts))\n      .then((cursor) => {\n        let record\n        this._handleErrors(cursor)\n        if (cursor && cursor.changes && cursor.changes.length && cursor.changes[0].new_val) {\n          record = cursor.changes[0].new_val\n        } else {\n          throw new Error('Not Found')\n        }\n        return [record, cursor]\n      })\n  },\n\n  _updateAll (mapper, props, query, opts) {\n    props || (props = {})\n    query || (query = {})\n    opts || (opts = {})\n\n    const updateOpts = this.getOpt('updateOpts', opts)\n    updateOpts.returnChanges = true\n\n    return this.filterSequence(this.selectTable(mapper, opts), query)\n      .update(props, updateOpts)\n      .run(this.getOpt('runOpts', opts))\n      .then((cursor) => {\n        let records = []\n        this._handleErrors(cursor)\n        if (cursor && cursor.changes && cursor.changes.length) {\n          records = cursor.changes.map((change) => change.new_val)\n        }\n        return [records, cursor]\n      })\n  },\n\n  _updateMany (mapper, records, opts) {\n    records || (records = [])\n    opts || (opts = {})\n\n    const insertOpts = this.getOpt('insertOpts', opts)\n    insertOpts.returnChanges = true\n    insertOpts.conflict = 'update'\n\n    return this.selectTable(mapper, opts)\n      .insert(records, insertOpts)\n      .run(this.getOpt('runOpts', opts))\n      .then((cursor) => {\n        records = []\n        this._handleErrors(cursor)\n        if (cursor && cursor.changes && cursor.changes.length) {\n          records = cursor.changes.map((change) => change.new_val)\n        }\n        return [records, cursor]\n      })\n  },\n\n  _applyWhereFromObject (where) {\n    const fields = []\n    const ops = []\n    const predicates = []\n    utils.forOwn(where, (clause, field) => {\n      if (!utils.isObject(clause)) {\n        clause = {\n          '==': clause\n        }\n      }\n      utils.forOwn(clause, (expr, op) => {\n        fields.push(field)\n        ops.push(op)\n        predicates.push(expr)\n      })\n    })\n    return {\n      fields,\n      ops,\n      predicates\n    }\n  },\n\n  _applyWhereFromArray (where) {\n    const groups = []\n    where.forEach((_where, i) => {\n      if (utils.isString(_where)) {\n        return\n      }\n      const prev = where[i - 1]\n      const parser = utils.isArray(_where) ? this._applyWhereFromArray : this._applyWhereFromObject\n      const group = parser.call(this, _where)\n      if (prev === 'or') {\n        group.isOr = true\n      }\n      groups.push(group)\n    })\n    groups.isArray = true\n    return groups\n  },\n\n  _testObjectGroup (rql, group, row, opts) {\n    let i\n    const r = this.r\n    const fields = group.fields\n    const ops = group.ops\n    const predicates = group.predicates\n    const len = ops.length\n    for (i = 0; i < len; i++) {\n      let op = ops[i]\n      const isOr = op.charAt(0) === '|'\n      op = isOr ? op.substr(1) : op\n      const predicateFn = this.getOperator(op, opts)\n      if (predicateFn) {\n        const predicateResult = predicateFn(r, row, fields[i], predicates[i])\n        if (isOr) {\n          rql = rql ? rql.or(predicateResult) : predicateResult\n        } else {\n          rql = rql ? rql.and(predicateResult) : predicateResult\n        }\n      } else {\n        throw new Error(`Operator ${op} not supported!`)\n      }\n    }\n    return rql\n  },\n\n  _testArrayGroup (rql, groups, row, opts) {\n    let i\n    const len = groups.length\n    for (i = 0; i < len; i++) {\n      const group = groups[i]\n      let subQuery\n      if (group.isArray) {\n        subQuery = this._testArrayGroup(rql, group, row, opts)\n      } else {\n        subQuery = this._testObjectGroup(null, group, row, opts)\n      }\n      if (groups[i - 1]) {\n        if (group.isOr) {\n          rql = rql.or(subQuery)\n        } else {\n          rql = rql.and(subQuery)\n        }\n      } else {\n        rql = rql ? rql.and(subQuery) : subQuery\n      }\n    }\n    return rql\n  },\n\n  /**\n   * Apply the specified selection query to the provided RQL sequence.\n   *\n   * @name RethinkDBAdapter#filterSequence\n   * @method\n   * @param {object} mapper The mapper.\n   * @param {object} [query] Selection query.\n   * @param {object} [query.where] Filtering criteria.\n   * @param {string|Array} [query.orderBy] Sorting criteria.\n   * @param {string|Array} [query.sort] Same as `query.sort`.\n   * @param {number} [query.limit] Limit results.\n   * @param {number} [query.skip] Offset results.\n   * @param {number} [query.offset] Same as `query.skip`.\n   * @param {object} [opts] Configuration options.\n   * @param {object} [opts.operators] Override the default predicate functions\n   * for specified operators.\n   */\n  filterSequence (sequence, query, opts) {\n    const r = this.r\n\n    query = utils.plainCopy(query || {})\n    opts || (opts = {})\n    opts.operators || (opts.operators = {})\n    query.where || (query.where = {})\n    query.orderBy || (query.orderBy = query.sort)\n    query.orderBy || (query.orderBy = [])\n    query.skip || (query.skip = query.offset)\n\n    // Transform non-keyword properties to \"where\" clause configuration\n    utils.forOwn(query, (config, keyword) => {\n      if (reserved.indexOf(keyword) === -1) {\n        if (utils.isObject(config)) {\n          query.where[keyword] = config\n        } else {\n          query.where[keyword] = {\n            '==': config\n          }\n        }\n        delete query[keyword]\n      }\n    })\n\n    let rql = sequence\n\n    // Filter\n    let groups\n\n    if (utils.isObject(query.where) && Object.keys(query.where).length !== 0) {\n      groups = this._applyWhereFromArray([query.where])\n    } else if (utils.isArray(query.where)) {\n      groups = this._applyWhereFromArray(query.where)\n    }\n\n    if (groups) {\n      rql = rql.filter((row) => this._testArrayGroup(null, groups, row, opts) || true)\n    }\n\n    // Sort\n    if (query.orderBy) {\n      if (utils.isString(query.orderBy)) {\n        query.orderBy = [\n          [query.orderBy, 'asc']\n        ]\n      }\n      for (var i = 0; i < query.orderBy.length; i++) {\n        if (utils.isString(query.orderBy[i])) {\n          query.orderBy[i] = [query.orderBy[i], 'asc']\n        }\n        rql = (query.orderBy[i][1] || '').toUpperCase() === 'DESC' ? rql.orderBy(r.desc(query.orderBy[i][0])) : rql.orderBy(query.orderBy[i][0])\n      }\n    }\n\n    // Offset\n    if (query.skip) {\n      rql = rql.skip(+query.skip)\n    }\n\n    // Limit\n    if (query.limit) {\n      rql = rql.limit(+query.limit)\n    }\n\n    return rql\n  },\n\n  selectDb (opts) {\n    return this.r.db(utils.isUndefined(opts.db) ? this.rOpts.db : opts.db)\n  },\n\n  selectTable (mapper, opts) {\n    return this.selectDb(opts).table(mapper.table || underscore(mapper.name))\n  },\n\n  waitForDb (opts) {\n    opts || (opts = {})\n    const db = utils.isUndefined(opts.db) ? this.rOpts.db : opts.db\n    if (!this.databases[db]) {\n      this.databases[db] = this.r.branch(\n        this.r.dbList().contains(db),\n        true,\n        this.r.dbCreate(db)\n      ).run()\n    }\n    return this.databases[db]\n  },\n\n  waitForTable (mapper, opts) {\n    opts || (opts = {})\n    const table = utils.isString(mapper) ? mapper : (mapper.table || underscore(mapper.name))\n    let db = utils.isUndefined(opts.db) ? this.rOpts.db : opts.db\n    return this.waitForDb(opts).then(() => {\n      this.tables[db] = this.tables[db] || {}\n      if (!this.tables[db][table]) {\n        this.tables[db][table] = this.r.branch(this.r.db(db).tableList().contains(table), true, this.r.db(db).tableCreate(table)).run()\n      }\n      return this.tables[db][table]\n    })\n  },\n\n  waitForIndex (table, index, opts) {\n    opts || (opts = {})\n    let db = utils.isUndefined(opts.db) ? this.rOpts.db : opts.db\n    return this.waitForDb(opts).then(() => this.waitForTable(table, opts)).then(() => {\n      this.indices[db] = this.indices[db] || {}\n      this.indices[db][table] = this.indices[db][table] || {}\n      if (!this.tables[db][table][index]) {\n        this.tables[db][table][index] = this.r.branch(this.r.db(db).table(table).indexList().contains(index), true, this.r.db(db).table(table).indexCreate(index)).run().then(() => {\n          return this.r.db(db).table(table).indexWait(index).run()\n        })\n      }\n      return this.tables[db][table][index]\n    })\n  },\n\n  /**\n   * Return the number of records that match the selection query.\n   *\n   * @name RethinkDBAdapter#count\n   * @method\n   * @param {object} mapper the mapper.\n   * @param {object} [query] Selection query.\n   * @param {object} [query.where] Filtering criteria.\n   * @param {string|Array} [query.orderBy] Sorting criteria.\n   * @param {string|Array} [query.sort] Same as `query.sort`.\n   * @param {number} [query.limit] Limit results.\n   * @param {number} [query.skip] Offset results.\n   * @param {number} [query.offset] Same as `query.skip`.\n   * @param {object} [opts] Configuration options.\n   * @param {object} [opts.operators] Override the default predicate functions\n   * for specified operators.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {object} [opts.runOpts] Options to pass to r#run.\n   * @return {Promise}\n   */\n  count (mapper, query, opts) {\n    opts || (opts = {})\n    query || (query = {})\n\n    return this.waitForTable(mapper, opts)\n      .then(() => __super__.count.call(this, mapper, query, opts))\n  },\n\n  /**\n   * Create a new record.\n   *\n   * @name RethinkDBAdapter#create\n   * @method\n   * @param {object} mapper The mapper.\n   * @param {object} props The record to be created.\n   * @param {object} [opts] Configuration options.\n   * @param {object} [opts.insertOpts] Options to pass to r#insert.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {object} [opts.runOpts] Options to pass to r#run.\n   * @return {Promise}\n   */\n  create (mapper, props, opts) {\n    props || (props = {})\n    opts || (opts = {})\n\n    return this.waitForTable(mapper, opts)\n      .then(() => __super__.create.call(this, mapper, props, opts))\n  },\n\n  /**\n   * Create multiple records in a single batch.\n   *\n   * @name RethinkDBAdapter#createMany\n   * @method\n   * @param {object} mapper The mapper.\n   * @param {object} props The records to be created.\n   * @param {object} [opts] Configuration options.\n   * @param {object} [opts.insertOpts] Options to pass to r#insert.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {object} [opts.runOpts] Options to pass to r#run.\n   * @return {Promise}\n   */\n  createMany (mapper, props, opts) {\n    props || (props = {})\n    opts || (opts = {})\n\n    return this.waitForTable(mapper, opts)\n      .then(() => __super__.createMany.call(this, mapper, props, opts))\n  },\n\n  /**\n   * Destroy the record with the given primary key.\n   *\n   * @name RethinkDBAdapter#destroy\n   * @method\n   * @param {object} mapper The mapper.\n   * @param {(string|number)} id Primary key of the record to destroy.\n   * @param {object} [opts] Configuration options.\n   * @param {object} [opts.deleteOpts] Options to pass to r#delete.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {object} [opts.runOpts] Options to pass to r#run.\n   * @return {Promise}\n   */\n  destroy (mapper, id, opts) {\n    opts || (opts = {})\n\n    return this.waitForTable(mapper, opts)\n      .then(() => __super__.destroy.call(this, mapper, id, opts))\n  },\n\n  /**\n   * Destroy the records that match the selection query.\n   *\n   * @name RethinkDBAdapter#destroyAll\n   * @method\n   * @param {object} mapper the mapper.\n   * @param {object} [query] Selection query.\n   * @param {object} [query.where] Filtering criteria.\n   * @param {string|Array} [query.orderBy] Sorting criteria.\n   * @param {string|Array} [query.sort] Same as `query.sort`.\n   * @param {number} [query.limit] Limit results.\n   * @param {number} [query.skip] Offset results.\n   * @param {number} [query.offset] Same as `query.skip`.\n   * @param {object} [opts] Configuration options.\n   * @param {object} [opts.deleteOpts] Options to pass to r#delete.\n   * @param {object} [opts.operators] Override the default predicate functions\n   * for specified operators.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {object} [opts.runOpts] Options to pass to r#run.\n   * @return {Promise}\n   */\n  destroyAll (mapper, query, opts) {\n    opts || (opts = {})\n    query || (query = {})\n\n    return this.waitForTable(mapper, opts)\n      .then(() => __super__.destroyAll.call(this, mapper, query, opts))\n  },\n\n  /**\n   * Retrieve the record with the given primary key.\n   *\n   * @name RethinkDBAdapter#find\n   * @method\n   * @param {object} mapper The mapper.\n   * @param {(string|number)} id Primary key of the record to retrieve.\n   * @param {object} [opts] Configuration options.\n   * @param {string[]} [opts.fields] Select a subset of fields to be returned.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {object} [opts.runOpts] Options to pass to r#run.\n   * @param {string[]} [opts.with=[]] Relations to eager load.\n   * @return {Promise}\n   */\n  find (mapper, id, opts) {\n    opts || (opts = {})\n    opts.with || (opts.with = [])\n\n    const relationList = mapper.relationList || []\n    let tasks = [this.waitForTable(mapper, opts)]\n\n    relationList.forEach((def) => {\n      const relationName = def.relation\n      const relationDef = def.getRelation()\n      if (!opts.with || opts.with.indexOf(relationName) === -1) {\n        return\n      }\n      if (def.foreignKey && def.type !== 'belongsTo') {\n        if (def.type === 'belongsTo') {\n          tasks.push(this.waitForIndex(mapper.table || underscore(mapper.name), def.foreignKey, opts))\n        } else {\n          tasks.push(this.waitForIndex(relationDef.table || underscore(relationDef.name), def.foreignKey, opts))\n        }\n      }\n    })\n    return Promise.all(tasks).then(() => __super__.find.call(this, mapper, id, opts))\n  },\n\n  /**\n   * Retrieve the records that match the selection query.\n   *\n   * @name RethinkDBAdapter#findAll\n   * @method\n   * @param {object} mapper The mapper.\n   * @param {object} [query] Selection query.\n   * @param {object} [query.where] Filtering criteria.\n   * @param {string|Array} [query.orderBy] Sorting criteria.\n   * @param {string|Array} [query.sort] Same as `query.sort`.\n   * @param {number} [query.limit] Limit results.\n   * @param {number} [query.skip] Offset results.\n   * @param {number} [query.offset] Same as `query.skip`.\n   * @param {object} [opts] Configuration options.\n   * @param {string[]} [opts.fields] Select a subset of fields to be returned.\n   * @param {object} [opts.operators] Override the default predicate functions\n   * for specified operators.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {object} [opts.runOpts] Options to pass to r#run.\n   * @param {string[]} [opts.with=[]] Relations to eager load.\n   * @return {Promise}\n   */\n  findAll (mapper, query, opts) {\n    opts || (opts = {})\n    opts.with || (opts.with = [])\n    query || (query = {})\n\n    const relationList = mapper.relationList || []\n    let tasks = [this.waitForTable(mapper, opts)]\n\n    relationList.forEach((def) => {\n      const relationName = def.relation\n      const relationDef = def.getRelation()\n      if (!opts.with || opts.with.indexOf(relationName) === -1) {\n        return\n      }\n      if (def.foreignKey && def.type !== 'belongsTo') {\n        if (def.type === 'belongsTo') {\n          tasks.push(this.waitForIndex(mapper.table || underscore(mapper.name), def.foreignKey, opts))\n        } else {\n          tasks.push(this.waitForIndex(relationDef.table || underscore(relationDef.name), def.foreignKey, opts))\n        }\n      }\n    })\n    return Promise.all(tasks).then(() => __super__.findAll.call(this, mapper, query, opts))\n  },\n\n  /**\n   * Resolve the predicate function for the specified operator based on the\n   * given options and this adapter's settings.\n   *\n   * @name RethinkDBAdapter#getOperator\n   * @method\n   * @param {string} operator The name of the operator.\n   * @param {object} [opts] Configuration options.\n   * @param {object} [opts.operators] Override the default predicate functions\n   * for specified operators.\n   * @return {*} The predicate function for the specified operator.\n   */\n  getOperator (operator, opts) {\n    opts || (opts = {})\n    opts.operators || (opts.operators = {})\n    let ownOps = this.operators || {}\n    return utils.isUndefined(opts.operators[operator]) ? ownOps[operator] : opts.operators[operator]\n  },\n\n  /**\n   * Return the sum of the specified field of records that match the selection\n   * query.\n   *\n   * @name RethinkDBAdapter#sum\n   * @method\n   * @param {object} mapper The mapper.\n   * @param {string} field The field to sum.\n   * @param {object} [query] Selection query.\n   * @param {object} [query.where] Filtering criteria.\n   * @param {string|Array} [query.orderBy] Sorting criteria.\n   * @param {string|Array} [query.sort] Same as `query.sort`.\n   * @param {number} [query.limit] Limit results.\n   * @param {number} [query.skip] Offset results.\n   * @param {number} [query.offset] Same as `query.skip`.\n   * @param {object} [opts] Configuration options.\n   * @param {object} [opts.operators] Override the default predicate functions\n   * for specified operators.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {object} [opts.runOpts] Options to pass to r#run.\n   * @return {Promise}\n   */\n  sum (mapper, field, query, opts) {\n    opts || (opts = {})\n    query || (query = {})\n\n    return this.waitForTable(mapper, opts)\n      .then(() => __super__.sum.call(this, mapper, field, query, opts))\n  },\n\n  /**\n   * Apply the given update to the record with the specified primary key.\n   *\n   * @name RethinkDBAdapter#update\n   * @method\n   * @param {object} mapper The mapper.\n   * @param {(string|number)} id The primary key of the record to be updated.\n   * @param {object} props The update to apply to the record.\n   * @param {object} [opts] Configuration options.\n   * @param {object} [opts.updateOpts] Options to pass to r#update.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {object} [opts.runOpts] Options to pass to r#run.\n   * @return {Promise}\n   */\n  update (mapper, id, props, opts) {\n    props || (props = {})\n    opts || (opts = {})\n\n    return this.waitForTable(mapper, opts)\n      .then(() => __super__.update.call(this, mapper, id, props, opts))\n  },\n\n  /**\n   * Apply the given update to all records that match the selection query.\n   *\n   * @name RethinkDBAdapter#updateAll\n   * @method\n   * @param {object} mapper The mapper.\n   * @param {object} props The update to apply to the selected records.\n   * @param {object} [query] Selection query.\n   * @param {object} [query.where] Filtering criteria.\n   * @param {string|Array} [query.orderBy] Sorting criteria.\n   * @param {string|Array} [query.sort] Same as `query.sort`.\n   * @param {number} [query.limit] Limit results.\n   * @param {number} [query.skip] Offset results.\n   * @param {number} [query.offset] Same as `query.skip`.\n   * @param {object} [opts] Configuration options.\n   * @param {object} [opts.operators] Override the default predicate functions\n   * for specified operators.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {object} [opts.runOpts] Options to pass to r#run.\n   * @param {object} [opts.updateOpts] Options to pass to r#update.\n   * @return {Promise}\n   */\n  updateAll (mapper, props, query, opts) {\n    props || (props = {})\n    query || (query = {})\n    opts || (opts = {})\n\n    return this.waitForTable(mapper, opts)\n      .then(() => __super__.updateAll.call(this, mapper, props, query, opts))\n  },\n\n  /**\n   * Update the given records in a single batch.\n   *\n   * @name RethinkDBAdapter#updateMany\n   * @method\n   * @param {object} mapper The mapper.\n   * @param {Object[]} records The records to update.\n   * @param {object} [opts] Configuration options.\n   * @param {object} [opts.insertOpts] Options to pass to r#insert.\n   * @param {boolean} [opts.raw=false] Whether to return a more detailed\n   * response object.\n   * @param {object} [opts.runOpts] Options to pass to r#run.\n   * @return {Promise}\n   */\n  updateMany (mapper, records, opts) {\n    records || (records = [])\n    opts || (opts = {})\n\n    return this.waitForTable(mapper, opts)\n      .then(() => __super__.updateMany.call(this, mapper, records, opts))\n  }\n})\n\n/**\n * Details of the current version of the `js-data-rethinkdb` module.\n *\n * @example <caption>ES2015 modules import</caption>\n * import {version} from 'js-data-rethinkdb'\n * console.log(version.full)\n *\n * @example <caption>CommonJS import</caption>\n * var version = require('js-data-rethinkdb').version\n * console.log(version.full)\n *\n * @name module:js-data-rethinkdb.version\n * @type {object}\n * @property {string} version.full The full semver value.\n * @property {number} version.major The major version number.\n * @property {number} version.minor The minor version number.\n * @property {number} version.patch The patch version number.\n * @property {(string|boolean)} version.alpha The alpha version value,\n * otherwise `false` if the current version is not alpha.\n * @property {(string|boolean)} version.beta The beta version value,\n * otherwise `false` if the current version is not beta.\n */\nexport const version = '<%= version %>'\n\n/**\n * {@link RethinkDBAdapter} class.\n *\n * @example <caption>ES2015 modules import</caption>\n * import {RethinkDBAdapter} from 'js-data-rethinkdb'\n * const adapter = new RethinkDBAdapter()\n *\n * @example <caption>CommonJS import</caption>\n * var RethinkDBAdapter = require('js-data-rethinkdb').RethinkDBAdapter\n * var adapter = new RethinkDBAdapter()\n *\n * @name module:js-data-rethinkdb.RethinkDBAdapter\n * @see RethinkDBAdapter\n * @type {Constructor}\n */\n\n/**\n * Registered as `js-data-rethinkdb` in NPM.\n *\n * @example <caption>Install from NPM</caption>\n * npm i --save js-data-rethinkdb@beta js-data@beta rethinkdbdash\n *\n * @example <caption>ES2015 modules import</caption>\n * import {RethinkDBAdapter} from 'js-data-rethinkdb'\n * const adapter = new RethinkDBAdapter()\n *\n * @example <caption>CommonJS import</caption>\n * var RethinkDBAdapter = require('js-data-rethinkdb').RethinkDBAdapter\n * var adapter = new RethinkDBAdapter()\n *\n * @module js-data-rethinkdb\n */\n\n/**\n * Create a subclass of this RethinkDBAdapter:\n * @example <caption>RethinkDBAdapter.extend</caption>\n * // Normally you would do: import {RethinkDBAdapter} from 'js-data-rethinkdb'\n * const JSDataRethinkDB = require('js-data-rethinkdb@3.0.0-beta.8')\n * const {RethinkDBAdapter} = JSDataRethinkDB\n * console.log('Using JSDataRethinkDB v' + JSDataRethinkDB.version.full)\n *\n * // Extend the class using ES2015 class syntax.\n * class CustomRethinkDBAdapterClass extends RethinkDBAdapter {\n *   foo () { return 'bar' }\n *   static beep () { return 'boop' }\n * }\n * const customRethinkDBAdapter = new CustomRethinkDBAdapterClass()\n * console.log(customRethinkDBAdapter.foo())\n * console.log(CustomRethinkDBAdapterClass.beep())\n *\n * // Extend the class using alternate method.\n * const OtherRethinkDBAdapterClass = RethinkDBAdapter.extend({\n *   foo () { return 'bar' }\n * }, {\n *   beep () { return 'boop' }\n * })\n * const otherRethinkDBAdapter = new OtherRethinkDBAdapterClass()\n * console.log(otherRethinkDBAdapter.foo())\n * console.log(OtherRethinkDBAdapterClass.beep())\n *\n * // Extend the class, providing a custom constructor.\n * function AnotherRethinkDBAdapterClass () {\n *   RethinkDBAdapter.call(this)\n *   this.created_at = new Date().getTime()\n * }\n * RethinkDBAdapter.extend({\n *   constructor: AnotherRethinkDBAdapterClass,\n *   foo () { return 'bar' }\n * }, {\n *   beep () { return 'boop' }\n * })\n * const anotherRethinkDBAdapter = new AnotherRethinkDBAdapterClass()\n * console.log(anotherRethinkDBAdapter.created_at)\n * console.log(anotherRethinkDBAdapter.foo())\n * console.log(AnotherRethinkDBAdapterClass.beep())\n *\n * @method RethinkDBAdapter.extend\n * @param {object} [props={}] Properties to add to the prototype of the\n * subclass.\n * @param {object} [props.constructor] Provide a custom constructor function\n * to be used as the subclass itself.\n * @param {object} [classProps={}] Static properties to add to the subclass.\n * @returns {Constructor} Subclass of this RethinkDBAdapter class.\n * @since 3.0.0\n */\n"],"names":["__super__","Adapter","prototype","R_OPTS_DEFAULTS","INSERT_OPTS_DEFAULTS","UPDATE_OPTS_DEFAULTS","DELETE_OPTS_DEFAULTS","RUN_OPTS_DEFAULTS","equal","r","row","field","value","default","eq","notEqual","ne","OPERATORS","gt","ge","lt","le","setIntersection","expr","count","contains","not","Object","freeze","RethinkDBAdapter","opts","classCallCheck","defineProperties","undefined","call","insertOpts","fillIn","updateOpts","deleteOpts","runOpts","operators","rOpts","rethinkdbdash","extend","cursor","errors","first_error","Error","mapper","query","filterSequence","selectTable","run","getOpt","then","props","returnChanges","insert","_handleErrors","record","changes","length","new_val","records","map","change","id","get","delete","_pluck","rql","utils","isString","fields","isArray","pluck","sum","update","conflict","where","ops","predicates","forOwn","clause","isObject","op","push","groups","forEach","_where","i","prev","parser","_applyWhereFromArray","_applyWhereFromObject","group","isOr","len","charAt","substr","predicateFn","getOperator","predicateResult","or","and","subQuery","_testArrayGroup","_testObjectGroup","sequence","plainCopy","orderBy","sort","skip","offset","config","keyword","reserved","indexOf","keys","filter","toUpperCase","desc","limit","db","isUndefined","selectDb","table","underscore","name","databases","branch","dbList","dbCreate","waitForDb","tables","tableList","tableCreate","index","waitForTable","indices","indexList","indexCreate","indexWait","create","createMany","destroy","destroyAll","with","relationList","tasks","def","relationName","relation","relationDef","getRelation","foreignKey","type","waitForIndex","Promise","all","find","findAll","operator","ownOps","updateAll","updateMany","version"],"mappings":"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"}